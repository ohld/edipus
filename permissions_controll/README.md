# Модель контроля доступа
### (для Linux)

### Зачем это:
Доступ в директорию `/home/secret_docs` только для пользователей в группе 'secret'.

### Как это использовать:
1. Откройте терминал 
1. Переключитесь на пользователя-администратора (в Linux он называется 'root'):
  
  ```
  sudo su root
  ```

1. Создайте директорию `/home/common/` со всеми разрешениями для всех (это будет директорией в системе, в которой смогут работать все пользователи):
  
  ```
  mkdir /home/common
  chmod a+wrx /home/common
  ```

1. Добавьте две строки в файл `/etc/rc.local` (укажите свои пути к этим двум скриптам):
  
  ```
  /home/reset_secret_group.bash
  /home/give_permissions &
  ```
  
  rc.local - это скрипт, который исполняется при каждой перезагрузке системы.
  Первая строка удаляет всех пользователей из группы 'secter', так что после этого доступ нужно запрашивать заново.
  Вторая сторка запускает процесс-демон на фоне системы. Этот процесс имеет права на добавление пользователей в группы. Он будет принимать запросы на получение доступа и добавлять пользователей в группу 'secret'.
  
1. Создайте саму группу 'secret':

  ```
  groupadd secret
  ```

1. Создайте секретную директорию в группе 'secret' и закройте публичный боступ в неё (для этой директории пользователи будут запрашивать доступ):
  
  ```
  mkdir /home/secret_docs
  chgrp secret /home/secret_docs
  chmod a-wrx, /home/secret_docs
  chmod ug=wrx /home/secret_docs
  ```

Теперь любой пользователь (не администратор) сможет работать с файлами в директории `/home/secret_docs` только после того, как запустят исполняемый файл `checkpass`, передав ему как аргумент правильный пароль.
Пароль - edipus:
```
bin/checkpass edipus
access has been granted
```
Для применения изменений в группах пользователю нужно перезайти в систему (зоздать новую рабочую сессию, в которой будут загружены уже обновлённые группы).

### Как защитить модель от взлома:
Процессы `give_permissions` и `checkpass` обмениваются данными через специальный файл FIFO (FIrst In First Out) со специальным именем (второй отправляет первому запрос на добавление пользователя в группу 'secret'). Любой пользователь, создавший FIFO файл с таким же именем и записавший в него своё имя (username), получит доступ к секретным файлам без ввода пароля или распознаваня лица. Это значит, что имя этого FIFO файла и механизм передачи информации через него должны быть скрыты. Для этого **АБСОЛЮТНО ВСЕ** файлы проекта должны быть закрыты (с помощью BASH-команды chmod) на запись, чтение и исполнение для **ВСЕХ**. Программы `checkpass` и `validate.py` (распознающая лица) должны быть доступны для любого пользователя, но только для исполнения.

### Как искользовать эту систему с EDIPUS:
Программа, распознающая лица (`validate.py`), делает то же самое, что и `checkpass`. Только вместо пароля у неё распознавание. Программа `checkpass` в данном случае написана для простой демонстрации и быстрой проверки работы процесса-демона `give_permissions`.
