# Модель контроля доступа
### (для Linux)

### Зачем это:
Доступ к файлам в директории `/home/secret_docs` только для пользователей из группы 'secret'.

### Как это использовать:
1. Откройте терминал 
1. Переключитесь на пользователя-администратора (в Linux он называется 'root'):
  
  ```
  sudo su root
  ```

1. Создайте директорию `/home/common` со всеми разрешениями для всех (это будет директорией в системе, в которой смогут работать все пользователи):
  
  ```
  mkdir /home/common
  chmod a+wrx /home/common
  ```

1. Добавьте эти строки в файл `/etc/rc.local` (укажите свои путь программам):
  
  ```
  cd /home/edipus/permissions_control
  ./reset_secret_group.bash
  ./give_access.py &
  ```
  
  rc.local - это скрипт, который исполняется при каждой перезагрузке.
  Вторая строка удаляет всех пользователей из секретной группы.
  Третья сторка запускает процесс-демон на фоне системы. Этот процесс имеет права на добавление пользователей в группы. Он будет принимать запросы на получение доступа и добавлять пользователей в группу 'secret'.
  
1. Создайте саму группу 'secret':

  ```
  groupadd secret
  ```

1. Создайте секретную директорию в группе 'secret' и закройте публичный боступ в неё (для этой директории пользователи будут запрашивать доступ):
  
  ```
  mkdir /home/secret_docs
  chgrp secret /home/secret_docs
  chmod a-wrx /home/secret_docs
  chmod ug=wrx /home/secret_docs
  ```

Теперь любой пользователь (не администратор) сможет работать с файлами в директории `/home/secret_docs` только после того, как запустbт исполняемый файл `get_access.py`, передав ему как аргумент правильный пароль.
Пароль - edipus:
```
./get_access.py edipus
```
После этого порецесс-демон `give_access.py` добавит данного пользователя в группу 'secret' и из-под этой группы откроет редактор Sublime со всеми докуметами из секретной директории (нужен Sublime). После этого пользователь будет удален из группы. Поэтому работать с документами можно только данному пользователю и только в данном открытом окне редактора. После закрытия окна доступ нужно запрашивать заново.

### Как защитить модель от взлома:
Процессы `give_access.py` и `get_access.py` обмениваются данными через специальный файл FIFO (FIrst In First Out) со специальным именем (второй отправляет первому запрос на добавление пользователя в группу 'secret'). Любой пользователь, создавший FIFO файл с таким же именем и записавший в него своё имя (username), получит доступ к секретным файлам без ввода пароля или распознаваня лица. Это значит, что имя этого FIFO файла и механизм передачи информации через него должны быть скрыты. Для этого **АБСОЛЮТНО ВСЕ** файлы проекта должны быть закрыты (с помощью BASH-команды `chmod`) на запись, чтение и исполнение для **ВСЕХ**. Программы `validate.py` (распознающая лица) и  `get_access.py` должны быть доступны для любого пользователя, но только для исполнения.

### Как искользовать эту систему с EDIPUS:
Программа, распознающая пользователей (`validate.py`), делает то же самое, что и `get_access.py`. Только вместо пароля у неё распознавание. Программа `get_access.py` в данном случае написана для простой демонстрации и быстрой проверки работы процесса-демона `give_access.py`.
